<!-- Partner Listing Module -->
{% set table = module.hubdb_table %}
{% set categories_filters = hubdb_table_column(table, "integration_categories") %}
{% set partners = hubdb_table_rows(table, "orderBy=name") %}

{# Build array of used categories from partners #}
{% set used_categories = [] %}

{% for partner in partners %}
  {% for category in partner.integration_categories %}
    {% if category.name not in used_categories %}
      {% do used_categories.append(category.name) %}
    {% endif %}
  {% endfor %}
{% endfor %}

<div class="partner-listing-wrapper">
  <div class="partner-listing-container py-8 lg:py-12">
    <div class="flex flex-col lg:flex-row gap-8">

      <!-- Left Sidebar - Filters -->
      <aside class="partner-filters w-full lg:w-64 flex-shrink-0">

        <!-- Collections Filter -->
        <div class="filter-group mb-10">
          <p class="text-sm mb-2 text-[#202223] font-semibold">Filters</p>
          <div class="filter-options flex flex-wrap gap-3">
            <div class="w-full">
              <button
                class="category-filter rounded-md filter-button px-3 py-1 text-sm border-2 border-[#D9E2EB] bg-white text-[#0F2D29] cursor-pointer hover:border-[#10b981] hover:bg-[#10b981] hover:text-white transition-all"
                data-filter-type="all"
                data-filter-value="all"
              >
                All
              </button>
            </div>

            {% for option in module.filters %}
            {% if option.value in used_categories %}
            <div class="w-full">
              <button
                class="category-filter rounded-md filter-button px-3 py-1 text-sm border-2 border-[#D9E2EB] bg-white text-[#0F2D29] cursor-pointer hover:border-[#10b981] hover:bg-[#10b981] hover:text-white transition-all"
                data-filter-type="{{ option.value }}"
                data-filter-value="{{ option.value }}"
              >
                {{ option.label_ }}
              </button>
            </div>
            {% endif %}
            {% endfor %}
          </div>
        </div>
      </aside>

       <!-- Featured Integrations Section -->
       {% set featured_partners = [] %}
       {% set regular_partners = [] %}
       {% for partner in partners %}
         {% if partner.featured && partner.integration_categories|length > 0 %}
           {% do featured_partners.append(partner) %}
         {% elif partner.integration_categories|length > 0 %}
           {% do regular_partners.append(partner) %}
         {% endif %}
       {% endfor %}

      <!-- Right Content - Partner Cards Grid -->
      <main class="partner-grid-container flex-1 w-full">

        {% if featured_partners %}
        <div class="featured-section mb-12">
          <h2 class="text-2xl font-bold text-[#1F252B] mb-6">Featured Integrations</h2>
          <div class="partner-grid grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 lg:gap-6">
            {% for partner in featured_partners %}
            <{% if partner.url %}a{% else %}div{% endif %}
              {% if partner.url %}
              href="{{ partner.url }}"
              target="_blank"
              rel="noopener noreferrer"
              {% endif %}
              class="flex flex-col partner-card bg-white rounded-lg shadow-sm border border-gray-200 p-4 lg:p-6 hover:shadow-md transition-shadow no-underline hover:no-underline hover:border-[#23E596]"
              data-categories="{% for cat in partner.integration_categories %}{{ cat.name }}{% if not loop.last %},{% endif %}{% endfor %}"
              data-capabilities="{% for cap in partner.capabilities %}{{ cap.name }}{% if not loop.last %},{% endif %}{% endfor %}"
              data-featured="true"
            >
            <div class="parter-name flex items-center gap-4 mb-3">
              <!-- Partner Logo -->
              <div class="partner-logo">
                {% if partner.image.url %}
                <img
                  src="{{ partner.image.url }}"
                  alt="{{ partner.image.altText or partner.name }}"
                  width="{{ partner.image.width }}"
                  height="{{ partner.image.height }}"
                  class="inline-block bg-[#F4F7F9] rounded-3xl"
                >
                {% else %}
                <div class="w-full h-full bg-gray-200 rounded"></div>
                {% endif %}
              </div>

              <!-- Partner Name -->
              <h3 class="partner-name text-base text-[#1F252B] font-bold mb-0">
                {{ partner.name }}
              </h3>
            </div>

            {% if module.show_card_description %}
              <!-- Partner Description -->
              <div class="partner-description text-gray-600 text-[14px]">
                {{ partner.description }}
              </div>
            {% endif %}
              <!-- Category Tags -->
              <div class="partner-tags flex flex-wrap gap-2 mt-4">
                {% for category in partner.integration_categories %}
                <span class="category-tag p-1 text-[#1F252B] text-xs rounded border-[#D9E2EB] border">
                  {{ category.label }}
                </span>
                {% endfor %}
                {% for capability in partner.capabilities %}
                <span class="capability-tag p-1 text-[#1F252B] text-xs rounded border-[#D9E2EB] border">
                  {{ capability.label }}
                </span>
                {% endfor %}
              </div>

            </{% if partner.url %}a{% else %}div{% endif %}>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- All Integrations Section -->
        <div class="all-integrations-section">
          <h2 class="text-2xl font-bold text-[#1F252B] mb-6">All Integrations</h2>
          <div class="partner-grid grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 lg:gap-6">
            {% for partner in regular_partners %}

            <{% if partner.url %}a{% else %}div{% endif %}
              {% if partner.url %}
              href="{{ partner.url }}"
              target="_blank"
              rel="noopener noreferrer"
              {% endif %}
              class="flex flex-col partner-card bg-white rounded-lg shadow-sm border border-gray-200 p-4 lg:p-6 hover:shadow-md transition-shadow no-underline hover:no-underline hover:border-[#23E596]"
              data-categories="{% for cat in partner.integration_categories %}{{ cat.name }}{% if not loop.last %},{% endif %}{% endfor %}"
              data-capabilities="{% for cap in partner.capabilities %}{{ cap.name }}{% if not loop.last %},{% endif %}{% endfor %}"
              data-featured="false"
            >

              <div class="parter-name flex items-center gap-4  mb-3">
                <!-- Partner Logo -->
                <div class="partner-logo">
                  {% if partner.image.url %}
                  <img
                    src="{{ partner.image.url }}"
                    alt="{{ partner.image.altText or partner.name }}"
                    width="{{ partner.image.width }}"
                    height="{{ partner.image.height }}"
                    class="inline-block bg-[#F4F7F9] rounded-3xl"
                  >
                  {% else %}
                  <div class="w-full h-full bg-gray-200 rounded"></div>
                  {% endif %}
                </div>

                <!-- Partner Name -->
                <h3 class="partner-name text-base text-[#1F252B] font-bold mb-0">
                  {{ partner.name }}
                </h3>
              </div>


              {% if module.show_card_description %}
              <!-- Partner Description -->
              <div class="partner-description text-gray-600 text-[14px]">
                {{ partner.description }}
              </div>
              {% endif %}

              <!-- Category Tags -->
              <div class="partner-tags flex flex-wrap gap-2 mt-4">
                {% for category in partner.integration_categories %}
                <span class="category-tag p-1 text-[#1F252B] text-xs rounded border-[#D9E2EB] border">
                  {{ category.label }}
                </span>
                {% endfor %}
                {% for capability in partner.capabilities %}
                <span class="capability-tag p-1 text-[#1F252B] text-xs rounded border-[#D9E2EB] border">
                  {{ capability.label }}
                </span>
                {% endfor %}
              </div>

            </{% if partner.url %}a{% else %}div{% endif %}>
            {% endfor %}
          </div>
        </div>

        <!-- No Results Message -->
        <div class="no-results hidden text-center py-12">
          <p class="text-gray-500 text-lg">No partners found matching your filters.</p>
        </div>
      </main>

    </div>
  </div>
</div>